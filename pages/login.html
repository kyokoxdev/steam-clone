<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - GameHub</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/accessibility.css">
</head>
<body>
    <!-- Skip to main content link for screen readers -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Header Section -->
    <header class="main-header">
        <div class="container">
            <div class="logo">
                <a href="../index.html">
                    <h1>Game<span>Hub</span></h1>
                </a>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="../index.html">Store</a></li>
                    <li><a href="library.html">Library</a></li>
                    <li><a href="community.html">Community</a></li>
                </ul>
            </nav>
            <div class="user-actions">
                <div class="search-bar">
                    <input type="text" placeholder="Search games...">
                    <button type="button" class="search-btn">
                        <span class="sr-only">Search</span>
                    </button>
                </div>
                <a href="cart.html" class="cart-icon">
                    <span class="sr-only">Cart</span>
                    <span class="cart-count">0</span>
                </a>
                <a href="login.html" class="login-btn active">Login</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="auth-page">
        <div class="container">
            <div class="auth-container">
                <div class="auth-header">
                    <h1 id="auth-title">Sign In</h1>
                    <p>Sign in to your GameHub account to access your game library, wishlist, and more.</p>
                </div>

                <div class="auth-methods">
                    <div class="auth-tabs" role="tablist" aria-labelledby="auth-title">
                        <button class="auth-tab active" id="login-tab" role="tab" aria-selected="true" aria-controls="login-panel" data-tab="login">Sign In</button>
                        <button class="auth-tab" id="register-tab" role="tab" aria-selected="false" aria-controls="register-panel" data-tab="register">Create Account</button>
                    </div>

                    <div class="auth-panels">
                        <div id="login-panel" role="tabpanel" aria-labelledby="login-tab" class="tab-panel active">
                            <form class="auth-form login-form active" id="login-form" aria-labelledby="login-heading">
                                <h2 id="login-heading" class="sr-only">Sign In Form</h2>
                                <div class="form-group">
                                    <label for="login-email">Email or Username</label>
                                    <input type="text" id="login-email" name="login-email" placeholder="Enter your email or username" required aria-required="true">
                                    <div id="login-email-error" class="form-error" aria-live="polite"></div>
                                </div>
                                <div class="form-group">
                                    <label for="login-password">Password</label>
                                    <div class="password-input">
                                        <input type="password" id="login-password" name="login-password" placeholder="Enter your password" required aria-required="true">
                                        <button type="button" class="password-toggle" aria-label="Show password" aria-pressed="false">
                                            <span class="sr-only">Show password</span>
                                        </button>
                                    </div>
                                    <div id="login-password-error" class="form-error" aria-live="polite"></div>
                                </div>
                                <div class="form-options">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="remember" id="remember">
                                        <span class="checkbox-text">Remember me</span>
                                    </label>
                                    <a href="reset-password.html" class="forgot-password">Forgot password?</a>
                                </div>
                                <div id="login-form-error" class="form-error" aria-live="assertive"></div>
                                <button type="submit" class="btn btn-primary btn-block">Sign In</button>
                            </form>
                        </div>

                        <div id="register-panel" role="tabpanel" aria-labelledby="register-tab" class="tab-panel" hidden>
                            <form class="auth-form register-form" id="register-form" aria-labelledby="register-heading">
                                <h2 id="register-heading" class="sr-only">Create Account Form</h2>
                                <div class="form-group">
                                    <label for="register-email">Email</label>
                                    <input type="email" id="register-email" name="register-email" placeholder="Enter your email" required aria-required="true">
                                    <div id="register-email-error" class="form-error" aria-live="polite"></div>
                                </div>
                                <div class="form-group">
                                    <label for="register-username">Username</label>
                                    <input type="text" id="register-username" name="register-username" placeholder="Choose a username" required aria-required="true" aria-describedby="username-requirements">
                                    <p id="username-requirements" class="form-hint">Username must be 3-20 characters and may include letters, numbers, and underscores.</p>
                                    <div id="register-username-error" class="form-error" aria-live="polite"></div>
                                </div>
                                <div class="form-group">
                                    <label for="register-password" id="password-label">Password</label>
                                    <div class="password-input">
                                        <input type="password" id="register-password" name="register-password" placeholder="Create a password" required aria-required="true" aria-describedby="password-requirements">
                                        <button type="button" class="password-toggle" aria-label="Show password" aria-pressed="false">
                                            <span class="sr-only">Show password</span>
                                        </button>
                                    </div>
                                    <p id="password-requirements" class="form-hint">Password must be at least 8 characters and include uppercase, lowercase, numbers, and special characters.</p>
                                    <div class="password-strength" aria-live="polite">
                                        <div class="strength-meter" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="25" aria-labelledby="strength-text">
                                            <span class="strength-segment"></span>
                                            <span class="strength-segment"></span>
                                            <span class="strength-segment"></span>
                                            <span class="strength-segment"></span>
                                        </div>
                                        <span id="strength-text" class="strength-text">Password strength: Weak</span>
                                    </div>
                                    <div id="register-password-error" class="form-error" aria-live="polite"></div>
                                </div>
                                <div class="form-group">
                                    <label for="register-confirm">Confirm Password</label>
                                    <div class="password-input">
                                        <input type="password" id="register-confirm" name="register-confirm" placeholder="Confirm your password" required aria-required="true">
                                    </div>
                                    <div id="register-confirm-error" class="form-error" aria-live="polite"></div>
                                </div>
                                <div class="form-options">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="terms" id="terms" required aria-required="true">
                                        <span class="checkbox-text">I agree to the <a href="terms.html" target="_blank">Terms of Service</a> and <a href="privacy.html" target="_blank">Privacy Policy</a></span>
                                    </label>
                                    <div id="terms-error" class="form-error" aria-live="polite"></div>
                                </div>
                                <div id="register-form-error" class="form-error" aria-live="assertive"></div>
                                <button type="submit" class="btn btn-primary btn-block">Create Account</button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="social-auth">
                    <div class="separator" role="separator">
                        <span>OR</span>
                    </div>
                    <div class="social-buttons">
                        <button type="button" class="social-auth-btn google">
                            <span class="social-icon google-icon" aria-hidden="true"></span>
                            <span class="social-text">Continue with Google</span>
                        </button>
                        <button type="button" class="social-auth-btn facebook">
                            <span class="social-icon facebook-icon" aria-hidden="true"></span>
                            <span class="social-text">Continue with Facebook</span>
                        </button>
                        <button type="button" class="social-auth-btn apple">
                            <span class="social-icon apple-icon" aria-hidden="true"></span>
                            <span class="social-text">Continue with Apple</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="container">
            <div class="footer-columns">
                <div class="footer-column">
                    <h4>About GameHub</h4>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="careers.html">Careers</a></li>
                        <li><a href="press.html">Press</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Help</h4>
                    <ul>
                        <li><a href="support.html">Support</a></li>
                        <li><a href="refunds.html">Refunds</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>News</h4>
                    <ul>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="updates.html">Game Updates</a></li>
                        <li><a href="events.html">Events</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                        <li><a href="terms.html">Terms of Service</a></li>
                        <li><a href="legal.html">Legal Information</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="social-links">
                    <a href="#" class="social-icon">Facebook</a>
                    <a href="#" class="social-icon">Twitter</a>
                    <a href="#" class="social-icon">Instagram</a>
                    <a href="#" class="social-icon">Discord</a>
                </div>
                <p class="copyright">&copy; 2025 GameHub. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Screen reader announcer for dynamic content -->
    <div id="screen-reader-announcer" class="sr-only" aria-live="polite"></div>

    <script src="../js/utils.js"></script>
    <script src="../js/accessibility.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tab panel functionality
            const tabButtons = document.querySelectorAll('[role="tab"]');
            const tabPanels = document.querySelectorAll('[role="tabpanel"]');
            
            // Initialize tabs
            tabButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    // Deactivate all tabs
                    tabButtons.forEach(btn => {
                        btn.classList.remove('active');
                        btn.setAttribute('aria-selected', 'false');
                    });
                    
                    // Hide all panels
                    tabPanels.forEach(panel => {
                        panel.classList.remove('active');
                        panel.setAttribute('hidden', 'true');
                    });
                    
                    // Activate current tab
                    const currentBtn = e.currentTarget;
                    currentBtn.classList.add('active');
                    currentBtn.setAttribute('aria-selected', 'true');
                    
                    // Show corresponding panel
                    const panelId = currentBtn.getAttribute('aria-controls');
                    const targetPanel = document.getElementById(panelId);
                    targetPanel.classList.add('active');
                    targetPanel.removeAttribute('hidden');
                    
                    // Update main heading to reflect current tab
                    const authTitle = document.getElementById('auth-title');
                    authTitle.textContent = currentBtn.textContent;
                });
                
                // Add keyboard navigation
                button.addEventListener('keydown', (e) => {
                    const tabsArray = Array.from(tabButtons);
                    const index = tabsArray.indexOf(e.currentTarget);
                    
                    // Handle arrow keys
                    if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
                        e.preventDefault();
                        
                        let newIndex;
                        if (e.key === 'ArrowRight') {
                            newIndex = index < tabsArray.length - 1 ? index + 1 : 0;
                        } else {
                            newIndex = index > 0 ? index - 1 : tabsArray.length - 1;
                        }
                        
                        // Focus and activate the new tab
                        tabsArray[newIndex].focus();
                        tabsArray[newIndex].click();
                    }
                });
            });
            
            // Password toggle functionality
            const passwordToggles = document.querySelectorAll('.password-toggle');
            passwordToggles.forEach(toggle => {
                toggle.addEventListener('click', () => {
                    const passwordInput = toggle.previousElementSibling;
                    const isVisible = passwordInput.type === 'text';
                    
                    passwordInput.type = isVisible ? 'password' : 'text';
                    toggle.setAttribute('aria-pressed', !isVisible);
                    toggle.querySelector('.sr-only').textContent = isVisible ? 'Show password' : 'Hide password';
                });
            });
            
            // Form validation
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            
            if (loginForm) {
                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    let isValid = true;
                    
                    // Clear previous errors
                    document.querySelectorAll('.form-error').forEach(el => el.textContent = '');
                    
                    // Validate email/username
                    const emailInput = document.getElementById('login-email');
                    if (!emailInput.value.trim()) {
                        document.getElementById('login-email-error').textContent = 'Please enter your email or username';
                        emailInput.setAttribute('aria-invalid', 'true');
                        isValid = false;
                    } else {
                        emailInput.removeAttribute('aria-invalid');
                    }
                    
                    // Validate password
                    const passwordInput = document.getElementById('login-password');
                    if (!passwordInput.value) {
                        document.getElementById('login-password-error').textContent = 'Please enter your password';
                        passwordInput.setAttribute('aria-invalid', 'true');
                        isValid = false;
                    } else {
                        passwordInput.removeAttribute('aria-invalid');
                    }
                    
                    if (isValid) {
                        // Simulate login success (in a real app, this would call an API)
                        const screenReaderMsg = document.getElementById('screen-reader-announcer');
                        screenReaderMsg.textContent = 'Login successful. Redirecting to your account.';
                        
                        // Redirect after a brief delay
                        setTimeout(() => {
                            window.location.href = 'profile.html';
                        }, 1000);
                    } else {
                        // Focus the first invalid field
                        document.querySelector('[aria-invalid="true"]').focus();
                    }
                });
            }
            
            if (registerForm) {
                // Password strength indicator
                const passwordInput = document.getElementById('register-password');
                const strengthMeter = document.querySelector('.strength-meter');
                const strengthText = document.getElementById('strength-text');
                
                passwordInput.addEventListener('input', () => {
                    const password = passwordInput.value;
                    let strength = 0;
                    
                    // Evaluate password strength
                    if (password.length >= 8) strength += 25;
                    if (password.match(/[A-Z]/)) strength += 25;
                    if (password.match(/[0-9]/)) strength += 25;
                    if (password.match(/[^A-Za-z0-9]/)) strength += 25;
                    
                    // Update strength meter
                    strengthMeter.setAttribute('aria-valuenow', strength);
                    
                    // Update active segments
                    const segments = document.querySelectorAll('.strength-segment');
                    const activeSegments = Math.ceil(strength / 25);
                    
                    segments.forEach((segment, index) => {
                        if (index < activeSegments) {
                            segment.classList.add('active');
                        } else {
                            segment.classList.remove('active');
                        }
                    });
                    
                    // Update text description
                    let strengthDesc = 'Weak';
                    if (strength >= 75) strengthDesc = 'Strong';
                    else if (strength >= 50) strengthDesc = 'Good';
                    else if (strength >= 25) strengthDesc = 'Fair';
                    
                    strengthText.textContent = `Password strength: ${strengthDesc}`;
                });
                
                // Form submission
                registerForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    let isValid = true;
                    
                    // Clear previous errors
                    document.querySelectorAll('.form-error').forEach(el => el.textContent = '');
                    
                    // Validate email
                    const emailInput = document.getElementById('register-email');
                    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailPattern.test(emailInput.value)) {
                        document.getElementById('register-email-error').textContent = 'Please enter a valid email address';
                        emailInput.setAttribute('aria-invalid', 'true');
                        isValid = false;
                    } else {
                        emailInput.removeAttribute('aria-invalid');
                    }
                    
                    // Validate username
                    const usernameInput = document.getElementById('register-username');
                    const usernamePattern = /^[A-Za-z0-9_]{3,20}$/;
                    if (!usernamePattern.test(usernameInput.value)) {
                        document.getElementById('register-username-error').textContent = 'Username must be 3-20 characters with only letters, numbers, and underscores';
                        usernameInput.setAttribute('aria-invalid', 'true');
                        isValid = false;
                    } else {
                        usernameInput.removeAttribute('aria-invalid');
                    }
                    
                    // Validate password
                    const passwordValue = passwordInput.value;
                    if (passwordValue.length < 8 || 
                        !passwordValue.match(/[A-Z]/) || 
                        !passwordValue.match(/[0-9]/) || 
                        !passwordValue.match(/[^A-Za-z0-9]/)) {
                        document.getElementById('register-password-error').textContent = 'Password must meet all requirements';
                        passwordInput.setAttribute('aria-invalid', 'true');
                        isValid = false;
                    } else {
                        passwordInput.removeAttribute('aria-invalid');
                    }
                    
                    // Validate confirm password
                    const confirmInput = document.getElementById('register-confirm');
                    if (confirmInput.value !== passwordValue) {
                        document.getElementById('register-confirm-error').textContent = 'Passwords do not match';
                        confirmInput.setAttribute('aria-invalid', 'true');
                        isValid = false;
                    } else {
                        confirmInput.removeAttribute('aria-invalid');
                    }
                    
                    // Validate terms checkbox
                    const termsCheckbox = document.getElementById('terms');
                    if (!termsCheckbox.checked) {
                        document.getElementById('terms-error').textContent = 'You must agree to the Terms of Service and Privacy Policy';
                        isValid = false;
                    }
                    
                    if (isValid) {
                        // Simulate registration success
                        const screenReaderMsg = document.getElementById('screen-reader-announcer');
                        screenReaderMsg.textContent = 'Account created successfully. Redirecting to your profile.';
                        
                        // Show success message
                        const successMsg = document.createElement('div');
                        successMsg.className = 'alert alert-success';
                        successMsg.setAttribute('role', 'alert');
                        successMsg.textContent = 'Account created successfully!';
                        registerForm.parentElement.insertBefore(successMsg, registerForm);
                        
                        // Redirect after a delay
                        setTimeout(() => {
                            window.location.href = 'profile.html';
                        }, 2000);
                    } else {
                        // Focus the first invalid field
                        document.querySelector('[aria-invalid="true"]').focus();
                    }
                });
            }
        });
    </script>
</body>
</html>